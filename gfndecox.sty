\def\decosep{\par\indent}
\def\newdecoclass#1#2#3#4{%
  % ---- ---- ---- ----
  % #1 : class name
  % #2 : prefix
  % #3 : style
  % #4 : counter
  % ---- ---- ---- ----
  \long\def#1{%
    \def\gfndeco@selectbyoption{%
      \ifx[\gfndeco@maybeoption
        \def\gfndeco@selected{\csname gfndeco@labeled@#3\endcsname{#4}{#2}}%
      \else
        \ifx*\gfndeco@maybeoption
          \def\gfndeco@selected{\csname gfndeco@nonumber@#3\endcsname{#2}}%
        \else
          \def\gfndeco@selected{\csname gfndeco@number@#3\endcsname{#4}{#2}}%
        \fi
      \fi
      \gfndeco@selected
    }%
    \futurelet\gfndeco@maybeoption\gfndeco@selectbyoption
  }%
}
\def\newnonumberdecoclass#1#2#3{%
  % ---- ---- ---- ----
  % #1 : class name
  % #2 : prefix
  % #3 : style
  % ---- ---- ---- ----
  \long\def#1{\csname gfndeco@nonumber@#3\endcsname{#2}*}%
}
%
\def\gfndeco@unique{\gfndeco@uniquesub}
\def\gfndeco@ifempty#1#2#3{%
  \ifx\gfndeco@unique#1\gfndeco@unique#2\else#3\fi
}
  % ---- gfndeco@nonumber@xxx ----
  % #1 : prefix, #2 : title, #3 : content
  % ---- ---- ---- ----
  % ---- gfndeco@number@xxx ----
  % #1 : counter, #2 : prefix, #3 : title, #4 : content
  % ---- ---- ---- ----
  % ---- gfndeco@labeled@xxx ----
  % #1 : counter, #2 : prefix, #3 : label, #4 : title, #5 : content
  % ---- ---- ---- ----
%
% ---- 'top' style ----
\long\def\gfndeco@nonumber@top#1*#2#3{%
  \noindent\textsf{#1\gfndeco@ifempty{#2}{}{\enskip#2}}%
  \quad\ignorespaces#3\par
}
\long\def\gfndeco@number@top#1#2#3#4{%
  \refstepcounter{#1}%,
  \noindent\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#3}{}{\enskip#3}}%
  \quad\ignorespaces#4\par
}
\long\def\gfndeco@labeled@top#1#2[#3]#4#5{%
  \refstepcounter{#1}\label{#3}%
  \noindent\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#4}{}{\enskip#4}}%
  \quad\ignorespaces#5\par
}
% ---- 'std' style ----
\long\def\gfndeco@nonumber@std#1*#2#3{%
  \noindent\textsf{#1\enskip #2}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#3\par
}
\long\def\gfndeco@number@std#1#2#3#4{%
  \refstepcounter{#1}%
  \noindent\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#3}{}{\enskip#3}}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#4\par
}
\long\def\gfndeco@labeled@std#1#2[#3]#4#5{%
  \refstepcounter{#1}\label{#3}%
  \noindent\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#4}{}{\enskip#4}}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#5\par
}
% ---- 'ul' style ----
\long\def\gfndeco@nonumber@ul#1*#2#3{%
  \noindent\underline{\textsf{#1\gfndeco@ifempty{#2}{}{\enskip#2}}}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#3\par
}
\long\def\gfndeco@number@ul#1#2#3#4{%
  \refstepcounter{#1}%
  \noindent\underline{\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#3}{}{\enskip#3}}}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#4\par
}
\long\def\gfndeco@labeled@ul#1#2[#3]#4#5{%
  \refstepcounter{#1}\label{#3}%
  \noindent\underline{\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#4}{}{\enskip#4}}}\newline\nopagebreak
  \hskip\parindent\relax\ignorespaces#5\par
}
% ---- 'box' style ----
\long\def\gfndeco@nonumber@box#1*#2#3{%
  \noindent
  \begin{itembox}[l]{\textsf{#1\gfndeco@ifempty{#2}{}{\enskip#2}}}
    \ignorespaces#3%
  \end{itembox}\par
}
\long\def\gfndeco@number@box#1#2#3#4{%
  \refstepcounter{#1}%
  \noindent
  \begin{itembox}[l]{\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#3}{}{\enskip#3}}}%
    \ignorespaces#4%
  \end{itembox}\par
}
\long\def\gfndeco@labeled@box#1#2[#3]#4#5{%
  \refstepcounter{#1}\label{#3}%
  \noindent
  \begin{itembox}[l]{\textsf{#2\csname the#1\endcsname\gfndeco@ifempty{#4}{}{\enskip#4}}}%
    \ignorespaces#5%
  \end{itembox}\par
}
